import streamlit as st
import google.generativeai as genai

# --- é¡µé¢åŸºç¡€è®¾ç½® ---
st.set_page_config(page_title="ğŸ’†â€â™‚ï¸ æ™ºèƒ½æŒ‰æ‘©è¯Šæ–­ç³»ç»Ÿ", page_icon="ğŸ’†â€â™‚ï¸")

# --- 1. å®‰å…¨è¯»å– API Key ---
# è¿™ä¸€æ­¥æ˜¯ä¸ºäº†é˜²æ­¢ä½ çš„ Key è¢«ç›—ç”¨ã€‚
# æˆ‘ä»¬ä¸åœ¨ä»£ç é‡Œç›´æ¥å†™ Keyï¼Œè€Œæ˜¯è®©ä»£ç å»ç³»ç»Ÿçš„â€œä¿é™©ç®±â€é‡Œæ‰¾ã€‚
try:
    api_key = st.secrets["GOOGLE_API_KEY"]
except:
    # å¦‚æœæ‰¾ä¸åˆ° Keyï¼ˆæ¯”å¦‚ä½ åœ¨æœ¬åœ°è¿è¡Œï¼‰ï¼Œå°±ä¼šæç¤ºé”™è¯¯
    st.error("âš ï¸ æœªæ£€æµ‹åˆ° API Keyï¼è¯·åœ¨ Streamlit Cloud åå°çš„ Secrets é‡Œé…ç½® GOOGLE_API_KEYã€‚")
    st.stop()

# é…ç½® Gemini
genai.configure(api_key=api_key)
model = genai.GenerativeModel('gemini-1.5-flash')

# --- 2. ç½‘é¡µç•Œé¢è®¾è®¡ ---
st.title("ğŸ’†â€â™‚ï¸ æŒ‰æ‘©åº—æ™ºèƒ½å‰å°ç³»ç»Ÿ")
st.markdown("### AI è¾…åŠ©ç†ç–—æŠ¥å‘Šç”Ÿæˆå™¨")

# è¾“å…¥åŒºåŸŸ
with st.container():
    col1, col2 = st.columns(2)
    with col1:
        customer_name = st.text_input("å®¢äººç§°å‘¼", placeholder="ä¾‹å¦‚ï¼šå¼ å…ˆç”Ÿ")
        pain_point = st.text_input("ä¸»è¦ä¸é€‚/ç—›ç‚¹", placeholder="ä¾‹å¦‚ï¼šè‚©é¢ˆé…¸ç—›ï¼Œå³è…°å‘ç´§")
    with col2:
        sleep_quality = st.selectbox("æœ€è¿‘ç¡çœ è´¨é‡", ["ä¸€èˆ¬", "å¾ˆå¥½", "å·® (å¤±çœ /å¤šæ¢¦)", "ä¸è®ºæ—¶é—´éƒ½å¾ˆå›°"])
        pressure = st.slider("åå¥½åŠ›åº¦ (1-10)", 1, 10, 5)

    additional_info = st.text_area("å…¶ä»–å¤‡æ³¨", placeholder="ä¾‹å¦‚ï¼šé•¿æœŸä¼æ¡ˆå·¥ä½œï¼Œåˆšæ‰æ‰­ä¼¤ï¼Œä¸å–œæ¬¢æŒ‰å¤´éƒ¨...")

# --- 3. æ ¸å¿ƒé€»è¾‘ ---
if st.button("âœ¨ ç”Ÿæˆä¸“ä¸šè¯Šæ–­ä¹¦ (AI)", type="primary"):
    if not customer_name or not pain_point:
        st.warning("è¯·è‡³å°‘å¡«å†™â€œå®¢äººç§°å‘¼â€å’Œâ€œä¸»è¦ä¸é€‚â€ã€‚")
    else:
        with st.spinner('AI æ­£åœ¨åƒè€ä¸­åŒ»ä¸€æ ·æ€è€ƒ...è¯·ç¨å€™...'):
            # è¿™é‡Œæ˜¯å‘é€ç»™ AI çš„æŒ‡ä»¤
            prompt = f"""
            ä½ æ˜¯ä¸€ä½æ‹¥æœ‰20å¹´ç»éªŒçš„èµ„æ·±æ¾³æ´²ç†ç–—æŒ‰æ‘©å¸ˆã€‚è¯·æ ¹æ®ä»¥ä¸‹å®¢äººä¿¡æ¯ï¼Œç”Ÿæˆä¸€ä»½ä¸“ä¸šçš„ã€èº«ä½“å¥åº·ç®€æŠ¥ã€‘ã€‚
            
            ã€å®¢äººèµ„æ–™ã€‘
            å§“åï¼š{customer_name}
            ç—‡çŠ¶æè¿°ï¼š{pain_point}
            ç¡çœ æƒ…å†µï¼š{sleep_quality}
            åŠ›åº¦åå¥½ï¼š{pressure}/10
            å…¶ä»–å¤‡æ³¨ï¼š{additional_info}
            
            ã€è¯·æŒ‰ä»¥ä¸‹æ ¼å¼è¾“å‡ºæŠ¥å‘Šã€‘
            1. **ç—‡çŠ¶åˆ†æ**ï¼šç”¨ä¸“ä¸šä½†æ˜“æ‡‚çš„è¯­è¨€è§£é‡Šä¸ºä»€ä¹ˆä¼šç—›ï¼ˆä¾‹å¦‚æ¶‰åŠå“ªå—è‚Œè‚‰ï¼Œå¦‚æ–œæ–¹è‚Œã€ç«–è„Šè‚Œç­‰ï¼‰ã€‚
            2. **ä»Šæ—¥ç†ç–—æ–¹æ¡ˆå»ºè®®**ï¼š
               - æ¨èæ—¶é•¿ï¼ˆè¯·æ ¹æ®ç—‡çŠ¶æ¨è 60åˆ†é’Ÿã€90åˆ†é’Ÿæˆ–120åˆ†é’Ÿï¼‰ã€‚
               - é‡ç‚¹æ‰‹æ³•ï¼ˆå¦‚ï¼šæ·±å±‚ç»„ç»‡æŒ‰æ‘©ã€çƒ­çŸ³æ”¾æ¾ã€æ¿€ç—›ç‚¹ç–—æ³•ï¼‰ã€‚
               - *é”€å”®è¯æœ¯ï¼ˆå§”å©‰ï¼‰ï¼šè§£é‡Šä¸ºä»€ä¹ˆæ¨èè¿™ä¸ªæ—¶é•¿ï¼ˆä¾‹å¦‚ï¼šå› ä¸ºè‚Œè‚‰ç²˜è¿è¾ƒæ·±ï¼Œéœ€è¦æ›´é•¿æ—¶é—´æ¾è§£ï¼‰ã€‚*
            3. **å±…å®¶æŠ¤ç†å»ºè®®**ï¼šç»™1-2ä¸ªå›å®¶åçš„å»ºè®®ï¼ˆå¦‚çƒ­æ•·ã€æ‹‰ä¼¸åŠ¨ä½œï¼‰ã€‚
            
            æ³¨æ„ï¼šè¯­æ°”è¦æ¸©æš–ã€ä¸“ä¸šã€‚å¿…é¡»åœ¨æœ€åé™„å¸¦å…è´£å£°æ˜ï¼šæœ¬æŠ¥å‘Šä»…ä¾›ç†ç–—å‚è€ƒï¼Œä¸æ„æˆåŒ»ç–—è¯Šæ–­ã€‚
            """
            
            try:
                # è°ƒç”¨ AI
                response = model.generate_content(prompt)
                
                # å±•ç¤ºç»“æœ
                st.success("âœ… æŠ¥å‘Šå·²ç”Ÿæˆï¼")
                st.markdown("---")
                st.markdown(response.text)
                st.caption("Tips: æ‰‹æœºæˆªå›¾å³å¯å‘é€ç»™å®¢äºº")
                
            except Exception as e:
                st.error(f"è¿æ¥ AI å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ– Keyã€‚é”™è¯¯ä¿¡æ¯: {e}")

# é¡µè„š
st.markdown("---")
st.markdown("Created with â¤ï¸ by Gemini AI Studio")